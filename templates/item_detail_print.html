<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ item.name }} - Print</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            padding: 20px 40px;
            margin: 20px;
        }
        
        .page-container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .print-header {
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        
        .print-header h1 {
            font-size: 24px;
            margin: 0;
        }
        
        .info-row {
            display: flex;
            margin-bottom: 8px;
            page-break-inside: avoid;
        }
        
        .info-label {
            font-weight: 600;
            width: 150px;
            flex-shrink: 0;
        }
        
        .info-value {
            flex: 1;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 5px;
        }
        
        .description-content {
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #0dcaf0;
            border-radius: 4px;
            margin-bottom: 15px;
            overflow-x: auto;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .description-content table {
            width: 100%;
            table-layout: fixed;
        }
        
        .description-content table th,
        .description-content table td {
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            padding: 6px;
        }
        
        .description-content pre {
            max-width: 100%;
            overflow-x: auto;
        }
        
        .description-content code {
            word-wrap: break-word;
        }
        
        .badge {
            font-size: 10px;
            padding: 3px 6px;
            display: inline-block;
            margin-right: 4px;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .image-item {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            overflow: hidden;
            aspect-ratio: 1;
        }
        
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #f5f5f5;
        }
        
        .file-list {
            list-style: none;
            padding: 0;
        }
        
        .file-list li {
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-bottom: 5px;
            page-break-inside: avoid;
        }
        
        .url-list {
            list-style: none;
            padding: 0;
        }
        
        .url-list li {
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-bottom: 5px;
            word-break: break-all;
            page-break-inside: avoid;
        }
        
        .url-list a {
            color: #0d6efd;
            text-decoration: none;
        }
        
        .url-list a:hover {
            text-decoration: underline;
        }
        
        .file-url {
            color: #6c757d;
            font-size: 10px;
        }
        
        .param-item {
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-bottom: 5px;
            background-color: #f8f9fa;
            page-break-inside: avoid;
        }
        
        .print-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 9px;
            color: #666;
            padding: 10px 0;
            border-top: 1px solid #dee2e6;
            background-color: white;
        }
        
        @media print {
            body {
                padding: 15mm 15mm;
                margin: 0;
            }
            
            .print-footer {
                position: fixed;
                bottom: 0;
            }
            
            .no-print {
                display: none !important;
            }
            
            .page-break {
                page-break-before: always;
            }
            
            @page {
                margin: 0;
                @bottom-center {
                    content: counter(page);
                }
            }
            
            /* Ensure colors print */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* Make links visible in print */
            a[href]:after {
                content: "";
            }
        }
        
        @media screen {
            body {
                padding-bottom: 80px;
                max-width: 800px;
                margin: 20mm auto;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                background-color: white;
            }
            
            .print-footer {
                position: relative;
                margin-top: 30px;
            }
        }
    </style>
</head>
<body>
    <!-- Print Header -->
    <div class="print-header">
        <h1>{{ item.name }}</h1>
    </div>
    
    <!-- Print Button (hidden in print mode) -->
    <div class="no-print mb-3">
        <button onclick="window.print()" class="btn btn-primary btn-sm">
            <i class="bi bi-printer"></i> Print / Save as PDF
        </button>
        <button onclick="window.close()" class="btn btn-secondary btn-sm">
            <i class="bi bi-x-circle"></i> Close
        </button>
    </div>
    
    <!-- Basic Information -->
    <div class="section-title">Basic Information</div>
    
    <div class="info-row">
        <div class="info-label">UUID:</div>
        <div class="info-value"><code>{{ item.uuid }}</code></div>
    </div>
    
    <div class="info-row">
        <div class="info-label">SKU:</div>
        <div class="info-value">{{ item.sku or 'N/A' }}</div>
    </div>
    
    <div class="info-row">
        <div class="info-label">Type / Model:</div>
        <div class="info-value">{{ item.info or 'N/A' }}</div>
    </div>
    
    <div class="info-row">
        <div class="info-label">Category:</div>
        <div class="info-value">
            {% if item.category %}
                <span class="badge" style="background-color: {{ item.category.color }}; color: white;">{{ item.category.name }}</span>
            {% else %}
                None
            {% endif %}
        </div>
    </div>
    
    <div class="info-row">
        <div class="info-label">Footprint:</div>
        <div class="info-value">{{ item.footprint.name if item.footprint else 'None' }}</div>
    </div>
    
    <div class="info-row">
        <div class="info-label">Location:</div>
        <div class="info-value">{{ item.get_full_location() }}</div>
    </div>
    
    <div class="info-row">
        <div class="info-label">Tags:</div>
        <div class="info-value">
            {% if item.get_tags_list() %}
                {% for tag in item.get_tags_list() %}
                    <span class="badge" style="background-color: {{ tag.color }}; color: white;">{{ tag.name }}</span>
                {% endfor %}
            {% else %}
                None
            {% endif %}
        </div>
    </div>
    
    <!-- Description -->
    {% if item.description %}
    <div class="section-title">Description</div>
    <div class="description-content markdown-content">
        {{ item.description|markdown }}
    </div>
    {% endif %}
    
    <!-- Quantity and Price -->
    <div class="section-title">Quantity & Pricing</div>
    
    <div class="info-row">
        <div class="info-label">Total Quantity:</div>
        <div class="info-value"><strong>{{ item.quantity }}</strong></div>
    </div>
    
    {% if item.lend_to %}
    <div class="info-row">
        <div class="info-label">Lent:</div>
        <div class="info-value"><strong>{{ item.lend_quantity }}</strong> to {{ item.lend_to }}</div>
    </div>
    <div class="info-row">
        <div class="info-label">Available:</div>
        <div class="info-value"><strong>{{ item.get_available_quantity() }}</strong></div>
    </div>
    {% else %}
    <div class="info-row">
        <div class="info-label">Available:</div>
        <div class="info-value"><strong>{{ item.quantity }}</strong></div>
    </div>
    {% endif %}
    
    <div class="info-row">
        <div class="info-label">Min Quantity:</div>
        <div class="info-value">{{ item.min_quantity }}</div>
    </div>
    
    <div class="info-row">
        <div class="info-label">Status:</div>
        <div class="info-value">
            {% if item.is_no_stock() %}
                <span class="badge bg-danger">No Stock</span>
            {% elif item.is_low_stock() %}
                <span class="badge bg-warning text-dark">Low Stock (Min: {{ item.min_quantity }})</span>
            {% else %}
                <span class="badge bg-success">OK</span>
            {% endif %}
        </div>
    </div>
    
    <div class="info-row">
        <div class="info-label">Price per Unit:</div>
        <div class="info-value">{{ item.price|format_amount(currency_decimal_places) }}</div>
    </div>
    
    <div class="info-row">
        <div class="info-label">Total Price:</div>
        <div class="info-value"><strong>{{ item.get_total_price()|format_amount(currency_decimal_places) }}</strong></div>
    </div>
    
    <!-- Magic Parameters -->
    {% if item.magic_parameters %}
    <div class="section-title">Magic Parameters</div>
    {% for param in item.magic_parameters %}
    <div class="param-item">
        <strong>{{ param.parameter.name }}</strong>
        {% if param.parameter.param_type == 'number' %}
            {% if param.operation == 'min' %}MIN{% elif param.operation == 'max' %}MAX{% elif param.operation == 'range' %}RANGE{% elif param.operation == 'value' %}VALUE{% endif %}:
            {{ param.value }} {% if param.operation == 'range' %}- {{ param.value2 }}{% endif %} {{ param.unit }}
        {% elif param.parameter.param_type == 'date' %}
            {% if param.operation == 'start' %}START{% elif param.operation == 'end' %}END{% elif param.operation == 'duration' %}DURATION{% endif %}
            {% if param.operation != 'value' %}on {% endif %}{{ param.value }} {% if param.operation == 'duration' %}to {{ param.value2 }}{% endif %}
        {% elif param.parameter.param_type == 'string' %}
            {{ param.string_option }}
        {% endif %}
        {% if param.description %}<br><small>{{ param.description }}</small>{% endif %}
    </div>
    {% endfor %}
    {% endif %}
    
    <!-- Images -->
    {% set images = item.attachments | selectattr('file_type', 'in', ['png', 'jpg', 'jpeg', 'gif', 'webp']) | list %}
    {% if images %}
    <div class="section-title">Images ({{ images|length }})</div>
    <div class="image-grid">
        {% for att in images %}
        <div class="image-item">
            <img src="{{ url_for('uploaded_file', filename=att.filename) }}" alt="{{ att.original_filename }}">
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Other Files -->
    {% set other_files = item.attachments | rejectattr('file_type', 'in', ['png', 'jpg', 'jpeg', 'gif', 'webp']) | list %}
    {% if other_files %}
    <div class="section-title">Other Files ({{ other_files|length }})</div>
    <ul class="file-list">
        {% for att in other_files %}
        <li>
            <i class="bi bi-file-earmark-{% if att.file_type == 'pdf' %}pdf{% elif att.file_type in ['doc', 'docx'] %}word{% elif att.file_type in ['xls', 'xlsx'] %}excel{% elif att.file_type == 'txt' %}text{% else %}fill{% endif %}"></i>
            <strong>{{ att.original_filename }}</strong><br>
            <small>{{ att.file_type.upper() }} - {{ "%.2f"|format(att.file_size / 1024 / 1024) }} MB</small><br>
            <a href="{{ url_for('uploaded_file', filename=att.filename, _external=True) }}" class="file-url" target="_blank">{{ url_for('uploaded_file', filename=att.filename, _external=True) }}</a>
        </li>
        {% endfor %}
    </ul>
    {% endif %}
    
    <!-- Datasheet URLs -->
    {% if datasheets %}
    <div class="section-title">Datasheets</div>
    <ul class="url-list">
        {% for ds in datasheets %}
        <li>
            {% if ds.title %}<strong>{{ ds.title }}</strong><br>{% endif %}
            {% if ds.info %}<small>{{ ds.info }}</small><br>{% endif %}
            <a href="{{ ds.url }}" target="_blank">{{ ds.url }}</a>
        </li>
        {% endfor %}
    </ul>
    {% endif %}
    
    <!-- Timestamps -->
    <div class="section-title">Timestamps</div>
    <div class="info-row">
        <div class="info-label">Created:</div>
        <div class="info-value">{{ item.created_at.strftime('%Y-%m-%d %H:%M:%S') if item.created_at else 'N/A' }}</div>
    </div>
    <div class="info-row">
        <div class="info-label">Last Updated:</div>
        <div class="info-value">{{ item.updated_at.strftime('%Y-%m-%d %H:%M:%S') if item.updated_at else 'N/A' }}</div>
    </div>
    
    <!-- Print Footer -->
    <div class="print-footer">
        The data is printed by {{ current_user.username }} at {{ current_datetime }}. This data may change in future.
    </div>
</body>
</html>
