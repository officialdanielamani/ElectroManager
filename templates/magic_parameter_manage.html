{% extends "base.html" %}

{% block title %}Manage {{ parameter.name }} - Inventory Manager{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <h2>Manage Magic Parameter</h2>
        
        <!-- Parameter Details Card with Edit Form -->
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Parameter Details</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('magic_parameter_edit', id=parameter.id) }}">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" name="name" class="form-control" value="{{ parameter.name }}" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Type</label>
                        <input type="text" class="form-control" value="{{ parameter.param_type|title }}" disabled>
                        <small class="text-muted">Parameter type cannot be changed after creation</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="3">{{ parameter.description or '' }}</textarea>
                    </div>
                    
                    {% if parameter.param_type == 'date' %}
                    <div class="form-check mb-3">
                        <input type="checkbox" name="notify_enabled" class="form-check-input" id="notifyCheck" 
                               {% if parameter.notify_enabled %}checked{% endif %}>
                        <label class="form-check-label" for="notifyCheck">
                            Enable notifications <i class="bi bi-bell-fill text-warning"></i>
                        </label>
                    </div>
                    {% endif %}
                    
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Save Changes
                        </button>
                        <a href="{{ url_for('magic_parameters') }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Back to Magic Parameters
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        {% if parameter.param_type == 'number' %}
        <!-- Units Management for Number Type -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Units</h5>
            </div>
            <div class="card-body">
                <!-- Add Unit Form -->
                <form method="POST" action="{{ url_for('magic_parameter_add_unit', id=parameter.id) }}" class="mb-3">
                    <div class="input-group">
                        <input type="text" name="unit" class="form-control" placeholder="Add new unit (e.g., V, mA, Â°C)" required>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Add Unit
                        </button>
                    </div>
                </form>
                
                <!-- Units List -->
                {% if parameter.units %}
                <div class="list-group">
                    {% for unit in parameter.units %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span>{{ unit.unit }}</span>
                        <form method="POST" action="{{ url_for('magic_parameter_delete_unit', id=parameter.id, unit_id=unit.id) }}" style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete unit {{ unit.unit }}?')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No units defined. Add units above.</p>
                {% endif %}
            </div>
        </div>
        
        {% elif parameter.param_type == 'string' %}
        <!-- Options Management for String Type -->
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">String Options</h5>
            </div>
            <div class="card-body">
                <!-- Add Option Form -->
                <form method="POST" action="{{ url_for('magic_parameter_add_option', id=parameter.id) }}" class="mb-3">
                    <div class="input-group">
                        <input type="text" name="option" class="form-control" placeholder="Add new option" required>
                        <button type="submit" class="btn btn-secondary">
                            <i class="bi bi-plus-circle"></i> Add Option
                        </button>
                    </div>
                </form>
                
                <!-- Options List -->
                {% if parameter.string_options %}
                <div class="list-group">
                    {% for option in parameter.string_options %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span>{{ option.value }}</span>
                        <form method="POST" action="{{ url_for('magic_parameter_delete_option', id=parameter.id, option_id=option.id) }}" style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete option {{ option.value }}?')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No options defined. Add options above.</p>
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        <!-- Items Using This Parameter -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0">Items Using This Parameter</h5>
            </div>
            <div class="card-body">
                {% if parameter.item_parameters %}
                <div class="list-group">
                    {% for item_param in parameter.item_parameters %}
                    <a href="{{ url_for('item_detail', uuid=item_param.item.uuid) }}" class="list-group-item list-group-item-action">
                        <strong>{{ item_param.item.name }}</strong>
                        <br>
                        <small class="text-muted">{{ item_param.get_display_text() }}</small>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No items are using this parameter yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
